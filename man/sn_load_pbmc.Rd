% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data.R
\name{sn_load_pbmc}
\alias{sn_load_pbmc}
\title{Load PBMC datasets from Zenodo}
\usage{
sn_load_pbmc(
  dataset = "pbmc3k",
  matrix_type = c("filtered", "raw"),
  save_dir = "~/.shennong/data",
  return_object = TRUE,
  species = "human"
)
}
\arguments{
\item{dataset}{Character scalar. Which PBMC dataset to load.
One of \code{"pbmc1k"}, \code{"pbmc3k"}, \code{"pbmc4k"}, \code{"pbmc8k"}.
Default: \code{"pbmc3k"}.}

\item{matrix_type}{Character scalar. Which matrix type to load.
One of:
\itemize{
  \item \code{"filtered"}: the \code{filtered_feature_bc_matrix.h5}
        (Cell Ranger filtered barcodes).
  \item \code{"raw"}: the \code{raw_feature_bc_matrix.h5}
        (unfiltered barcodes; useful for ambient RNA correction tools
        such as SoupX).
}
Default: \code{"filtered"}.}

\item{save_dir}{Character scalar. Local cache directory where the downloaded
Zenodo files will be stored. The directory will be created if it does not
exist. Default: \code{"~/.shennong/data"}.}

\item{return_object}{Logical. If \code{TRUE} (default), the function returns
an in-memory object. If \code{FALSE}, the function only ensures that the
file is downloaded locally and then returns (invisibly) the local file
path.}

\item{species}{Character scalar. Species label passed to
\code{sn_initialize_seurat_object()} when constructing Seurat objects
(i.e. when \code{matrix_type == "filtered"}). Ignored if
\code{matrix_type == "raw"}. Default: \code{"human"}.}
}
\value{
One of:

\itemize{
  \item If \code{matrix_type == "filtered"} and
        \code{return_object = TRUE}:
        a Seurat object.

  \item If \code{matrix_type == "raw"} and
        \code{return_object = TRUE}:
        a sparse count matrix (e.g. \code{dgCMatrix}).

  \item If \code{return_object = FALSE}:
        the local file path to the cached \code{.h5} file,
        returned invisibly.
}
}
\description{
This function downloads (if not already cached) and loads processed
single-cell RNA-seq datasets of peripheral blood mononuclear cells (PBMCs)
from a Zenodo record. Each dataset (1k, 3k, 4k, or 8k) includes both
\emph{filtered} and \emph{raw} gene–barcode matrices in standard Cell Ranger
HDF5 format.
}
\details{
Instead of storing serialized R objects, the function caches the original
Zenodo \code{.h5} files locally for reproducibility and version consistency.
When requested, it dynamically constructs and returns either:
\itemize{
  \item a Seurat object (for filtered data), or
  \item a sparse count matrix (for raw data).
}
Users can also choose to only download/cache the data without loading it
into memory.


All datasets were re-aligned using Cell Ranger v9.0.1 with a custom reference
based on GENCODE v48 (GRCh38.p14).

\strong{Caching strategy}

The function caches the original files from Zenodo on first use:

\preformatted{
{dataset}_{matrix_type}_feature_bc_matrix.h5
}

For example, after loading \code{pbmc3k} you may see:

\preformatted{
~/.shennong/data/
├─ pbmc1k_filtered_feature_bc_matrix.h5
├─ pbmc1k_raw_feature_bc_matrix.h5
├─ pbmc3k_filtered_feature_bc_matrix.h5
├─ pbmc3k_raw_feature_bc_matrix.h5
├─ pbmc4k_filtered_feature_bc_matrix.h5
├─ pbmc4k_raw_feature_bc_matrix.h5
├─ pbmc8k_filtered_feature_bc_matrix.h5
└─ pbmc8k_raw_feature_bc_matrix.h5
}

When \code{return_object = TRUE}, the cached \code{.h5} file is read on the
fly:
\itemize{
  \item If \code{matrix_type == "filtered"}:
        a Seurat object is constructed via
        \code{sn_initialize_seurat_object()}.
  \item If \code{matrix_type == "raw"}:
        the function returns a sparse count matrix
        (typically a \code{dgCMatrix}), suitable for ambient RNA
        estimation / SoupX workflows.
}

When \code{return_object = FALSE}, no object is constructed;
only the file is ensured to exist locally.
}
\examples{
\dontrun{
# 1. Load filtered PBMC3k as a Seurat object:
pbmc <- sn_load_pbmc()

# 2. Load raw PBMC3k counts as a sparse matrix (for SoupX etc.):
pbmc_raw <- sn_load_pbmc(matrix_type = "raw")

# 3. Only download/cache PBMC8k, don't construct anything in-memory:
sn_load_pbmc(dataset = "pbmc8k", return_object = FALSE)

# 4. Use a custom cache directory:
pbmc4k <- sn_load_pbmc(
  dataset  = "pbmc4k",
  save_dir = "~/datasets/pbmc_cache"
)
}

}
\references{
Duan S. (2025).
Processed PBMC datasets re-aligned with Cell Ranger v9.0.1
(GENCODE v48, GRCh38.p14). Zenodo.
DOI: 10.5281/zenodo.14884845
}
\seealso{
\code{\link{sn_initialize_seurat_object}},
\code{\link{sn_read_matrix_h5}},
\code{\link{sn_write}},
\code{\link{sn_read}}
}
