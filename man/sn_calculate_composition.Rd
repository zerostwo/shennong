% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/composition.R
\name{sn_calculate_composition}
\alias{sn_calculate_composition}
\title{Calculate Composition Proportions}
\usage{
sn_calculate_composition(
  x,
  group_by,
  variable,
  min_cells = 20,
  additional_cols = NULL
)
}
\arguments{
\item{x}{A Seurat object or a data frame (e.g., metadata).}

\item{group_by}{A character string specifying the column name in the metadata
to group by (e.g., "sample_id", "treatment").}

\item{variable}{A character string specifying the column name in the metadata
for which to calculate proportions (e.g., "cell_type", "cluster_id").}

\item{min_cells}{An integer specifying the minimum number of cells required
for a group (defined by `group_by`) to be included in the analysis.
Defaults to 20. Set to 0 to include all groups.}

\item{additional_cols}{A character vector specifying the names of additional
metadata columns to include in the output table. These columns should ideally
have values that are constant within each `group_by` category. If values
are not constant, the function will use the first value encountered for each group
and issue a warning. Defaults to NULL.}
}
\value{
A data frame with the following columns:
  \item{group_by}{The grouping variable categories.}
  \item{variable}{The variable categories whose proportions are calculated.}
  \item{proportion}{The calculated proportion (percentage) for each variable category within each group.}
  \item{...}{Additional columns specified by `additional_cols`.}
}
\description{
Calculates the proportion of different categories within groups from metadata.
}
\details{
This function takes either a Seurat object or a data frame (like cell metadata)
and computes the percentage composition of a given `variable` (e.g., cell type)
for each category specified by `group_by` (e.g., sample, condition).
It allows filtering out groups with fewer than a minimum number of cells
and optionally adding other metadata columns to the results.
}
\examples{
\dontrun{
# Example 1: Using a Seurat object
# Assuming 'seu' is a Seurat object with metadata columns
# 'sample_id', 'cell_type', and 'treatment'
composition_df <- sn_calculate_composition(
  x = seu,
  group_by = "sample_id",
  variable = "cell_type",
  min_cells = 10
)
print(composition_df)

# Example 2: Adding additional metadata columns
composition_with_treatment <- sn_calculate_composition(
  x = seu,
  group_by = "sample_id",
  variable = "cell_type",
  min_cells = 10,
  additional_cols = "treatment"
)
print(composition_with_treatment)

# Example 3: Using a plain data frame
meta_df <- data.frame(
  sample = rep(c("A", "B", "C"), each = 50),
  ctype = sample(c("Tcell", "Bcell", "Myeloid"), 150, replace = TRUE),
  condition = rep(c("Control", "Treated", "Control"), each = 50),
  stringsAsFactors = FALSE
)
composition_from_df <- sn_calculate_composition(
  x = meta_df,
  group_by = "sample",
  variable = "ctype",
  min_cells = 5,
  additional_cols = "condition"
)
print(composition_from_df)

# Example 4: Handling groups with fewer cells than `min_cells`
small_meta_df <- data.frame(
  sample = c("A", "A", "B"),
  ctype = c("Tcell", "Bcell", "Tcell"),
  stringsAsFactors = FALSE
)
composition_small <- sn_calculate_composition(
  x = small_meta_df,
  group_by = "sample",
  variable = "ctype",
  min_cells = 2
)
print(composition_small)
}
}
